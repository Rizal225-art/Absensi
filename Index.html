<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Absensi Kelas - Terhubung Google Sheet</title>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 500px; margin: auto; background-color: #f4f4f4; color: #333; }
        h1 { color: #007bff; text-align: center; margin-bottom: 30px; }
        form { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], select, textarea { 
            width: 100%; 
            padding: 10px; 
            margin-bottom: 20px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
        }
        button { 
            padding: 12px 20px; 
            background-color: #28a745; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%;
            font-size: 16px;
        }
        button:hover:not(:disabled) { background-color: #218838; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        #response-message { 
            padding: 15px; 
            margin-top: 20px; 
            border-radius: 4px; 
            text-align: center;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>üìù Form Absensi Kelas</h1>
    
    <form id="attendance-form">
        
        <label for="NamaLengkap">Nama Lengkap:</label>
        <input type="text" id="NamaLengkap" name="NamaLengkap" required>

        <label for="StatusKehadiran">Status Kehadiran:</label>
        <select id="StatusKehadiran" name="StatusKehadiran" required>
            <option value="">Pilih Status</option>
            <option value="Hadir">Hadir</option>
            <option value="Sakit">Sakit</option>
            <option value="Izin">Izin</option>
            <option value="Alfa">Alfa</option>
        </select>

        <label for="Keterangan">Keterangan (Opsional):</label>
        <textarea id="Keterangan" name="Keterangan"></textarea>

        <button type="submit" id="submit-button">Kirim Absensi</button>
    </form>
    
    <div id="response-message" class="hidden"></div>

    <script>
        // PASTIKAN URL ini BENAR dan sudah DIDEPLOY sebagai Web App
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxmu0n-48rSh8fFMbOb45mbCnv7rXY2giKq2lq_qj40VrpLOckRF27kbPIkyUN_R5Md9Q/exec'; 

        const form = document.getElementById('attendance-form');
        const submitButton = document.getElementById('submit-button');
        const messageDiv = document.getElementById('response-message');

        form.addEventListener('submit', function(e) {
            e.preventDefault(); 
            
            // Nonaktifkan tombol dan tampilkan loading
            submitButton.disabled = true;
            submitButton.textContent = '‚è≥ Sedang Mengirim...';
            messageDiv.textContent = '';
            messageDiv.className = 'hidden';
            
            // Ambil data form
            const formData = new FormData(form);
            
            // Kirim data menggunakan Fetch API
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData 
            })
            .then(response => {
                // Skrip Apps Script terkadang merespons dengan HTML/teks, bukan JSON.
                // Kita coba parse sebagai JSON dulu, jika gagal, anggap sukses.
                return response.json().catch(() => ({ result: 'success' }));
            })
            .then(data => {
                if (data.result === 'success') {
                    messageDiv.textContent = '‚úÖ Absensi berhasil dicatat! Terima kasih.';
                    messageDiv.className = 'success';
                    form.reset(); // Kosongkan form setelah sukses
                } else {
                    // Tampilkan pesan error jika Apps Script mengirim respons error yang jelas
                    throw new Error(data.message || 'Gagal mengirim data ke Spreadsheet.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                messageDiv.textContent = `‚ùå Gagal: ${error.message || 'Periksa Apps Script Anda (kode/deployment).'}`;
                messageDiv.className = 'error';
            })
            .finally(() => {
                // Aktifkan kembali tombol setelah selesai
                submitButton.disabled = false;
                submitButton.textContent = 'Kirim Absensi';
            });
        });
    </script>
</body>
</html>